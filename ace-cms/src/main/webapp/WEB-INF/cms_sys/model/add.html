<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title></title>
    <#include "/cms_sys/head.html"/>

    <script src="${base}/thirdparty/swfupload/swfupload.js" type="text/javascript"></script>
    <script src="${base}/thirdparty/swfupload/swfupload.queue.js" type="text/javascript"></script>
    <script src="${base}/thirdparty/swfupload/fileprogress.js" type="text/javascript"></script>
    <script src="${base}/thirdparty/swfupload/handlers.js" type="text/javascript"></script>
    <link href="${base}/thirdparty/swfupload/process.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript">
        $(function() {
            $("#jvForm").validate();
        });

        var swfu;
        window.onload=function() {
            var uploadUrl = "http://localhost:8080/web-admin/frontcms/common/o_swfAttachsUpload.do";
            //在firefox、chrome下，上传不能保留登录信息，所以必须加上jsessionid。
            //var jsessionid = $.cookie("JSESSIONID");
            //if(jsessionid) {
            //    uploadUrl += ";jsessionid="+jsessionid;
           // }
            //alert(jsessionid);
            swfu=new SWFUpload({
                upload_url : uploadUrl,
                flash_url : "http://localhost:8080/web-admin/thirdparty/swfupload/swfupload.swf",
                file_size_limit : "1000 MB",
                post_params: {"root" : "/r/cms/caee/default/image"},
                file_types : "*.*",
                file_types_description : "All Files",
                file_queue_limit : 0,
                custom_settings : {
                    progressTarget : "fsUploadProgress",
                    cancelButtonId : "btnCancel"
                },
                debug: false,

                button_image_url : "${base}/thirdparty/swfupload/button_notext.png",
                button_placeholder_id : "spanButtonPlaceHolder",
                button_text: "<span class='btnText'>上传文件</span>",
                button_width: 81,
                button_height: 24,
                button_text_top_padding: 2,
                button_text_left_padding: 20,
                button_text_style: '.btnText{color:#666666;}',

                file_queued_handler : fileQueued,
                file_queue_error_handler : fileQueueError,
                file_dialog_complete_handler : fileDialogComplete,
                upload_start_handler : uploadStart,
                upload_progress_handler : uploadProgress,
                upload_error_handler : uploadError,
                upload_success_handler : uploadSuccess2,
                upload_complete_handler : uploadComplete,
                queue_complete_handler : queueComplete2
            });
        };
        function queueComplete2(numFilesUploaded) {
            alert(numFilesUploaded);
            //刷新页面
            //location.href="v_list.do?root=/r/cms/caee/default/image";
        }
        function uploadSuccess2(file, serverData) {
            try {
                var progress = new FileProgress(file, this.customSettings.progressTarget);
                progress.setComplete();
                progress.setStatus("Complete.");
                progress.toggleCancel(false);
                alert(serverData);
            } catch (ex) {
                this.debug(ex);
            }
        }

    </script>
</head>
<body>
<div class="box-positon">
    <div class="rpos">当前位置: 模型管理 - 添加</div>
    <form class="ropt">
        <input type="submit" value="返回列表" onclick="this.form.action='list.do';" class="return-button"/>
    </form>
    <div class="clear"/>
</div>
<div class="body-box">
    <div class="form_wrap" style="background:none;height:auto;">
        <form method="post" enctype="multipart/form-data">
            <input type="hidden" name="root" value="/r/cms/caee/default/image"/>
            <table border="0" style="padding-top:3px">
                <tr>
                    <td>当前目录: /r/cms/caee/default/image</td>
                    <td width="70" align="center"><span id="spanButtonPlaceHolder"></span></td>
                    <td><input class="cancel" id="btnCancel" type="button" value="取消" onclick="swfu.cancelQueue();" disabled="disabled" /></td>
                    <td>
                        &nbsp;	新建目录: <input type="text" name="dirName" size="10" onkeypress="if(event.keyCode==13){$('#dirButton').click();return false;}"/>
                        <input class="create-new" id="dirButton" type="submit" value="新建" onclick="this.form.method='post';this.form.action='o_create_dir.do';"/>
                    </td>
                </tr>
                <tr><td colspan="4"><div id="fsUploadProgress"></div></td></tr>
            </table>
        </form>







    <script type="text/javascript">
        //上传图片
        function upload(n) {
            var of = $("#uploadFile"+n);
            //检查是否选择了图片
            if(of.val()=="") {
                alert("请先选择图片");
                return;
            }
            //将file移动至上传表单
            $("#fileContent").empty();
            $("#fileContent").append(of);
            //复制一个file放至原处
            $("#ufc"+n).append(of.clone().attr("value",""));
            //修改属性
            $("#uploadFileText"+n).attr("value","");
            of.attr("id","");
            of.attr("name","uploadFile");
            //其他表单
            $("#ufFileName").val($("#fileName"+n).val());
            $("#ufWidth").val($("#zoomWidth"+n).val());
            $("#ufHeight").val($("#zoomHeight"+n).val());
            //先清除
            $("#ufMark").val("");
            $("#ufMark").val($("#mark"+n).val());
            $("#uploadNum").val(n);
            $("#uploadForm").submit();
        }
        //剪裁图片
        function imgCut(n) {
            if($("#uploadImgPath"+n).val()=="") {
                alert("请先上传图片");
                return;
            }
            var url = "../common/v_image_area_select.do?uploadNum="+n+"&imgSrcPath="
                    +$("#uploadImgPath"+n).val()+"&zoomWidth="+$("#zoomWidth"+n).val()+"&zoomHeight="+$("#zoomHeight"+n).val();
            window.open(url,"imgcut","height=550, width=1000, top=0, left=0, toolbar=no, menubar=no, scrollbars=auto, resizable=yes,location=no, status=no");
        }
        //预览图片
        function previewImg(n) {
            var img = $("#uploadImgPath"+n).val();
            if(img!="") {
                if(img.indexOf("?")==-1) {
                    $("#preImg"+n).attr("src",img+"?d="+new Date()*1);
                } else {
                    $("#preImg"+n).attr("src",img+"&d="+new Date()*1);
                }
                if(!$("#preImg"+n).attr("noResize")) {
                    $("#preImg"+n).css("width","auto");
                    $("#preImg"+n).css("height","auto");
                }
            } else {
                $("#preImg"+n).removeAttr("src");
            }
        }
    </script>


    <form id="uploadForm" action="../common/o_upload_image.do" method="post" enctype="multipart/form-data" target="hiddenIframe" style="display:none;width:0px;height:0px;">
        <span id="fileContent"></span>
        <input id="ufWidth" type="hidden" name="zoomWidth"/>
        <input id="ufHeight" type="hidden" name="zoomHeight"/>
        <input id="ufFileName" type="hidden" name="fileName"/>
        <input id="ufMark" type="hidden" name="mark"/>
        <input id="uploadNum" type="hidden" name="uploadNum"/>
    </form>
    <iframe name="hiddenIframe" frameborder="0" border="0" style="display:none;width:0px;height:0px;"></iframe>

    <script type="text/javascript">
        //上传附件
        function uploadMedia() {
            var mf = $("#mediaFile");
            //检查是否选择了文件
            if(mf.val()=="") {
                alert("请选择要上传的文件");
                return;
            }
            //将file移动至上传表单
            $("#mediaContent").empty();
            $("#mediaContent").append(mf);
            //复制一个file放至原处
            $("#mfc").append(mf.clone().attr('value',''));
            //修改属性
            mf.attr("id","");
            $("#mediaFileText").attr('value','');
            //其他表单
            $("#mediaFilename").val($("#origFilename").val());
            $("#mediaForm").submit();
        }
    </script>
    <form id="mediaForm" action="../common/o_upload_media.do" method="post" enctype="multipart/form-data" target="media_iframe" style="display:none;width:0px;height:0px;">
        <span id="mediaContent"></span>
        <input type="hidden" id="mediaFilename" name="filename"/>
    </form>
    <iframe name="media_iframe" frameborder="0" border="0" style="display:none;width:0px;height:0px;"></iframe>

    <form method="post" action="o_save.do" id="jvForm">
        <table width="100%" class="pn-ftable" cellpadding="2" cellspacing="1" border="0">
            <tr>
                <td width="10%" class="pn-flabel pn-flabel-h">
                    <span class="pn-frequired">*</span>标题:</td>
                <td colspan="3" class="pn-fcontent">
                    <input type="text" id="name" name="name" class="required" size="50" maxlength="100"/>
                </td>
            </tr>
            <tr>
                <td width="10%" class="pn-flabel pn-flabel-h">
                    <span class="pn-frequired">*</span>所属类目:</td>
                <td colspan="3" class="pn-fcontent">
                    <input type="text" id="categoryId" name="categoryId" class="required" size="50" maxlength="100"/>
                    必须选择末级节点.
                </td>
            </tr>
            <tr>
                <td width="10%" class="pn-flabel pn-flabel-h">
                    <span class="pn-frequired">*</span>所属人员:</td>
                <td colspan="3" class="pn-fcontent">
                    <input type="text" id="memberId" name="memberId" class="required" size="50" maxlength="100"/>
                    正常操作应在网站会员登陆后上传,此为便捷操作,但需指定模型所属人员ID.
                </td>
            </tr>

            <tr id="tr-typeImg">
                <td id="typeImg" width="10%" class="pn-flabel"><span class="pn-frequired">*</span>缩略图:</td>
                <td colspan="1" width="40%" class="pn-fcontent">
                    <input type="text" id="uploadImgPath0" name="typeImg" style="width:220px"/>
                    <input type="button" value="预览" onclick="previewImg(0);" class="preview-button"/>
                    <br/>
                    <span id="ufc0" style="position:relative">
                        <input type='text' id='uploadFileText0' size="14"/>
                        <input class="browse" type='button' value='浏览'/>
                        <input onchange="$('#uploadFileText0').val(this.value)" size="14" type="file" id="uploadFile0" class="file-button"/>
                    </span>
                    <label><input type="checkbox" onclick="$('#mark0').val(this.checked);"/>水印</label>
                    <input type="hidden" id="mark0" value="false"/>
                    <input type="button" value="上传" onclick="upload(0);" class="upload-button"/>
                    <br/>
                    宽: <input type="text" id="zoomWidth0" value="100" size="5"/>
                    高: <input type="text" id="zoomHeight0" value="100" size="5"/>
                    <input type="button" value="裁剪" onclick="imgCut(0);" class="cut-button"/>
                </td>
                <td colspan="2" class="pn-fbutton">
                    <img id="preImg0" alt="预览" style="width:100px;height:70px;background-color:#ccc;border:1px solid #333"/>
                </td>
            </tr>
            <tr>
                <td width="10%" class="pn-flabel pn-flabel-h"><span class="pn-frequired">*</span>资源上传:</td>
                <td colspan="3" class="pn-fcontent">
                    <div>
                        <input type="text" id="mediaPath" name="mediaPath" style="width:265px"/>
                    </div>
                    <div>
                        <span id="mfc" style="position:relative;display:block;width:300px;*width:300px;">
                        <input type='text' id='mediaFileText'/>
                        <input class="browse" type='button' value='浏览'/>
                        <input onchange="$('#mediaFileText').val(this.value)" size="19" type="file" name="mediaFile" id="mediaFile" style="height:24px;opacity:0;filter:alpha(opacity=0);position:absolute;right:79px;top:2px;"/>
                        <input type="button" value="上传" onclick="uploadMedia();" class="upload-button"/>
                        </span>
                    </div>
                </td>
            </tr>

            <tr>
                <td width="10%" class="pn-flabel pn-flabel-h"><span class="pn-frequired">*</span>模型尺寸</td>
                <td colspan="3" class="pn-fcontent">
                    长: <input type="text" id="length" name="length" value="0" class="required" size="5"/>
                    宽: <input type="text" id="width" name="width" value="0" class="required" size="5"/>
                    高: <input type="text" id="height" name="height" value="0" class="required" size="5"/>
                    &nbsp;&nbsp;&nbsp;&nbsp;
                    格式: <input type="text" id="style" name="style" value=".STL" class="required" size="5"/>
                </td>
            </tr>
            <tr>
                <td width="10%" class="pn-flabel pn-flabel-h"><span class="pn-frequired">*</span>下载限制</td>
                <td colspan="3" class="pn-fcontent">

                    人员限制: <select id="down_limit" name="down_limit">
                                <option value="0">普通人员</option>
                                <option value="1" selected>注册会员</option>
                             </select>&nbsp;&nbsp;&nbsp;&nbsp;
                    所需积分: <input type="text" id="point" name="point" value="0" size="5"/>
                </td>
            </tr>

            <tr>
                <td width="10%" class="pn-flabel pn-flabel-h">
                    <span class="pn-frequired">*</span>内容:</td>
                <td colspan="3" width="90%" class="pn-fcontent">
                    <textarea id="mark" name="mark" class="required" style="width:90%;height:150px"></textarea>
                </td>
            </tr>
            <tr>
                <td colspan="4" class="pn-fbutton">
                    <input type="submit" value="提交" class="submit"/> &nbsp; <input type="reset" value="重置" class="reset"/>
                </td>
            </tr>
        </table>
    </form>
    <#include "/cms_sys/common/error_message.html"/>
</div>
</body>
</html>