<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fighter.ace.cms.dao.external.AddrDao">

    <resultMap id="beanMap" type="com.fighter.ace.cms.entity.external.Addr">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="modified_time" property="modifiedTime" jdbcType="TIMESTAMP"/>

        <result column="member_id" property="memberId" jdbcType="BIGINT"/>
        <result column="name" property="name" jdbcType="VARCHAR"/>
        <result column="phone" property="phone" jdbcType="VARCHAR"/>
        <result column="addr" property="addr" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="INTEGER"/>
    </resultMap>

    <!-- 查询总页数 -->
    <select id="listPageCount" parameterType="java.util.Map" resultType="java.lang.Long">
        SELECT
        COUNT(1)
        FROM
        t_addr
        WHERE status != -1
        <if test="memberId != null">AND member_id = #{memberId}</if>
    </select>

    <!-- 查询分页地址 -->
    <select id="listPage" parameterType="java.util.Map" resultMap="beanMap">
        SELECT
        *
        FROM
        t_addr
        WHERE status != -1
        <if test="memberId != null">AND member_id = #{memberId}</if>
        ORDER BY id DESC
        LIMIT #{pageFirst},#{pageSize}
    </select>

    <!--添加地址-->
    <insert id="insert" parameterType="com.fighter.ace.cms.entity.external.Addr" keyProperty="id" useGeneratedKeys="true">
        INSERT t_addr(
        create_time,
        member_id,
        name,
        phone,
        addr,
        status)
        VALUES (
        now(),
        #{memberId},
        #{name},
        #{phone},
        #{addr},
        1
        )
    </insert>

    <!-- 删除地址 -->
    <update id="deleteById" parameterType="java.lang.Long">
        UPDATE t_addr
        SET
        modified_time = now(),
        status = -1
        where id = #{id}
    </update>

    <!-- 批量删除地址 -->
    <update id="batchDelete" parameterType="java.lang.Integer">
        UPDATE t_addr
        SET
        modified_time = now(),
        status = -1
        WHERE id in
        <foreach item="id" collection="array" open="(" separator ="," close=")">
            #{id}
        </foreach>
    </update>

    <!-- 更新 -->
    <update id="update" parameterType="com.fighter.ace.cms.entity.external.Addr">
        UPDATE t_addr
        SET modified_time = now()
        <if test="name != null">
            ,name = #{name}
        </if>
        <if test="phone != null">
            ,phone = #{phone}
        </if>
        <if test="addr != null">
            ,addr = #{addr}
        </if>
        WHERE id = #{id};
    </update>


    <!-- 详情 -->
    <select id="getById" resultMap="beanMap">
        select * from t_addr
        where id = #{id}
    </select>

</mapper>